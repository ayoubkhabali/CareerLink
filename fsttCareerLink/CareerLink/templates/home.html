{% extends 'base.html' %}
{% load static %}

{% block content %}

{% if request.user.is_authenticated %}
<main class="main-section">
    <section class="main-content">
        <div class="container">
        <h3 class="greetings">Welcome,  {{ request.user.username }}</h3>
        <style>
                input[type="text"],
                textarea {
                    width: 500px; /* Make input fields and textarea full width */
                    height: 50px;
                    resize: none;
                    padding: 10px; /* Add padding to input fields and textarea */
                    border: 1px solid #ccc; /* Add border to input fields and textarea */
                    border-radius: 5px; /* Add border radius to input fields and textarea */
                    box-sizing: border-box; /* Include padding and border in the width */
                }
                button {

                    padding: 10px 20px;
                    background-color: #FFF;
                    color: #000;
                    border: 1px solid #fff;
                    cursor: pointer;
                    font-size: 1.2rem;
                    background-color: #fff;
            
                }

                    .file-input input[type="file"]::-webkit-file-upload-button {
              visibility: hidden;
                }

                    .file-input input[type="file"]::before {
                        display: inline-block;
                        background: #007bff;
                        color: #fff;
                        border: none;
                        padding: 8px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                        content: 'media';
                    }



                    .file-input input[type="file"]:hover::before {
                        background: #0056b3;
                    }

                    .file-input input[type="file"]:active::before {
                        background: #003d6b;
                    }

                    .file-input input[type="file"]:focus::before {
                        outline: none;
                        border-color: #0056b3;
                        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
                    }

                    .file-input input[type="file"] {
                        display: inline-block;
                        margin-bottom: 0;
                        font-size: inherit;
                        line-height: normal;
                        vertical-align: middle;
                        cursor: pointer;
                    }

                    .new-post .bottom-part {
                        display: grid;
                        grid-template-columns: 1fr 1fr 1fr;
                    }                  


        </style>


        <div class="new-post">
            <div class="img-icon">
                <img src="{{user.profile_pic.url}}" alt="">
            </div>
            <form method="post" enctype="multipart/form-data">  <!-- Add enctype for file uploads -->
                {% csrf_token %}
             <div class="upper-part">
                {{ form.content }}
                {% if request.user.role == "TEACHER" %}
                {{ form.post_type }}  <!-- Add post_type field -->
                {% endif %}
             </div>
             <div class="bottom-part">
                <div class="file-input">
                    {{ form.post_media }}  <!-- Add post_type field -->

                </div>
                <div class="file-input">
                    {{ form.attachment }}  <!-- Add attachment field -->
                </div>
             </div>
             <input type="submit" value="Publish">
            </form>
            

        </div>



            {% if posts %}
            <h2>Recent Posts</h2>
            <div class="feeds">

            {% for post in posts %}


                <div class="feed">
                    <div class="head">
                        <div class="user">
                            <div class="profile-photo">
                                <img src="{{ request.user.profile_pic.url }}">
                            </div>
                            <div class="info">
                                <h3>{{post.author.username}}</h3>
                                <small>{{post.created_at}}</small>
                            </div>
                        </div>
                        <span class="edit">
                            <i class="uil uil-ellipsis-h"></i>
                        </span>
                    </div>

                    <div class="caption">
                        <br>
                        <p> {{post.content}}
                        <span class="harsh-tag">#lifestyle</span></p>
                    </div>
                    {% if post.post_media %}

                    <div class="photo">
                        <img src="{{post.post_media.url}}">
                    </div>
                    {% endif%}


                    <div class="action-buttons">
                        <div class="interaction-buttons">
                            <span><a href="{% url 'like_post' post_id=post.id %}"> <i class="uil uil-heart"></i> </a></span>
                            <span><i class="uil uil-comment-dots"></i></span>
                            <span><a href="{% url 'share_post' post_id=post.id %}"><i class="uil uil-share-alt"></i></a></span>
                        </div>

                    </div>

                    <div class="liked-by">
                        <p>Liked by {{post.likes}} people</b></p>
                    </div>

                    <div class="comments text-muted">
                        View all 277 comments
                    </div>
                </div>

            {% endfor %}
            </div>

            {% else %}
            <p>No posts found.</p>
        {% endif %}
    </section>

    <!-- <aside class="func">
        <div class="container">

        <div class="profileBx">

            <div class="user-cover" style="background-image: url('{{ user.profile_cover.url }}')">
                <div class="img-icon">
                    <img src="{{user.profile_pic.url}}" alt="">
                </div>
            </div>

            <div class="user-info">
                <h3 class="username">{{ request.user.username }}</h3>
                {% if student %}
                <p>University: {{ student.university }}</p>
                <p>Major: {{ student.major }}</p>
            {% else %}
                <p>No student information found for this user.</p>
            {% endif %}
                <p class="user-status"></p>
                <a class="btn editBtn" id="edit-btn"  href="{% url 'user_profile' username=user.username %}">Edit Profile <i class='bx bx-edit-alt'></i></a>
                <div class="user-stats">
                    <div class="posts-counts">
                       <h4>Posts</h4>
                       <span>{{request.user.posts.count}}</span>
                    </div>
                    <div class="post-contacts">
                        <h4>Followers</h4>
                        <span>{{request.user.followers.count}}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="recomBx">
            <h4 class="box-title">Add to your feed ...</h4>
            <div class="usersBx">
                <div class="userBx">
                    <div class="img-icon">
                        <img src="https://t3.ftcdn.net/jpg/02/43/12/34/240_F_243123463_zTooub557xEWABDLk0jJklDyLSGl2jrr.jpg" alt="">
                    </div>
                    <div class="user-info">
                        <h5 class="user-name">Ayoub khabali</h5>
                        <span class="user-status">Student at FSTT</span>
                        <button type="submit" class="addBtn">Follow <i class='bx bx-plus'></i></button>
                    </div>
                </div>
                <div class="userBx">
                    <div class="img-icon">
                        <img src="https://t3.ftcdn.net/jpg/02/43/12/34/240_F_243123463_zTooub557xEWABDLk0jJklDyLSGl2jrr.jpg" alt="">
                    </div>
                    <div class="user-info">
                        <h5 class="user-name">Ayoub khabali</h5>
                        <span class="user-status">Student at FSTT</span>
                        <button type="submit" class="addBtn">Follow <i class='bx bx-plus'></i></button>
                    </div>
                </div>
                <div class="userBx">
                    <div class="img-icon">
                        <img src="https://t3.ftcdn.net/jpg/02/43/12/34/240_F_243123463_zTooub557xEWABDLk0jJklDyLSGl2jrr.jpg" alt="">
                    </div>
                    <div class="user-info">
                        <h5 class="user-name">Ayoub khabali</h5>
                        <span class="user-status">Student at FSTT</span>
                        <button type="submit" class="addBtn">Follow <i class='bx bx-plus'></i></button>
                    </div>
                </div>

                
            </div>
        </div>
    </div>

    </aside> -->
</div>

</main>
{% endif %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$('.like-button').click(function(e) {
    e.preventDefault();
    var post_id = $(this).data('post-id');
    var likeButton = $(this);  // Store the like button element
    $.ajax({
        type: 'POST',
        url: '/home/' + post_id + '/like/',
        data: {
            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
        },
        success: function(data) {
            if (data.success) {
                // Update the like count on the page
                likeButton.closest('.post-actions').find('.likes-count').text(data.likes_count);
            }
        }
    });
});


</script>

{% endblock %}
